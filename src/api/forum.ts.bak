import { apiGet, apiPost } from "@/utils/request";
import type { ForumCommunity, ForumPost, ForumThread } from "@/types/forum";

export async function fetchForumPosts(): Promise<ForumPost[]> {
  return apiGet<ForumPost[]>("/forum/posts");
}

export async function fetchForumCommunities(): Promise<ForumCommunity[]> {
  return apiGet<ForumCommunity[]>("/forum/communities");
}

export async function fetchForumQuickFilters(): Promise<
  Array<{ label: string; value: string }>
> {
  return apiGet<Array<{ label: string; value: string }>>(
    "/forum/quick-filters",
  );
}

export async function fetchForumThread(
  postId: string,
  userId?: string,
): Promise<ForumThread> {
  const url = userId
    ? `/forum/posts/${postId}/thread?userId=${userId}`
    : `/forum/posts/${postId}/thread`;
  return apiGet<ForumThread>(url);
}

export async function createForumComment(
  postId: string,
  body: string,
  parentId?: string | null,
): Promise<void> {
  await apiPost<unknown>(`/forum/posts/${postId}/comments`, {
    body,
    parentId: parentId ?? null,
  });
}

export async function recordForumView(postId: string) {
  const userId = fetchCurrentUserId();
  if (!userId) return;
  return apiPost(`/views/forum/${postId}`, { userId });
}
